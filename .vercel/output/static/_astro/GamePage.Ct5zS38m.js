import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{r as g}from"./index.DiEladB3.js";import{Q as j,a as p,u as d,S as y,E as l,M as h,I as x,O as w}from"./ErrorBanner.CtW8yjaT.js";const v=new j({defaultOptions:{queries:{staleTime:3e4,retry:2,refetchOnWindowFocus:!1}}});function E({accountKey:t}){const[f,u]=g.useState(0),s=d({queryKey:["resolve",t],queryFn:async()=>{const r=await(await fetch(`/api/resolve?key=${encodeURIComponent(t)}`)).json();if(!r.ok)throw new Error(r.error?.message??"Resolve failed");return r.data}}),n=d({queryKey:["live-game",s.data?.puuid,f],queryFn:async()=>{const a=s.data.puuid,c=await(await fetch(`/api/live-game?puuid=${encodeURIComponent(a)}&platform=LA2`)).json();if(!c.ok)throw new Error(c.error?.message??"Live-game failed");return c.data},enabled:!!s.data?.puuid}),o=d({queryKey:["ddragon-bootstrap"],queryFn:async()=>{const r=await(await fetch("/api/ddragon/bootstrap")).json();if(!r.ok)throw new Error(r.error?.message??"DDragon failed");return r.data},staleTime:3600*1e3});if(s.isLoading||n.isLoading||o.isLoading)return e.jsx(y,{});if(s.isError)return e.jsx(l,{message:s.error.message});if(o.isError)return e.jsx(l,{message:`DDragon: ${o.error.message}`});if(n.isError)return e.jsx(l,{message:n.error.message});const i=n.data,m=o.data;return i?.available&&m?e.jsxs("div",{children:[e.jsx(h,{game:i,ddragon:m}),e.jsx("div",{className:"text-center mt-6",children:e.jsxs("button",{onClick:()=>u(a=>a+1),className:"inline-flex items-center gap-1.5 text-sm text-gray-400 hover:text-white transition-colors",children:[e.jsx(x,{className:"w-4 h-4"}),"Refrescar partida"]})})]}):e.jsxs("div",{children:[e.jsx(w,{account:s.data?.account,reason:i?.reason??"NOT_IN_GAME"}),e.jsx("div",{className:"text-center mt-4",children:e.jsxs("button",{onClick:()=>u(a=>a+1),className:"inline-flex items-center gap-1.5 text-sm text-gray-500 hover:text-gray-300 transition-colors",children:[e.jsx(x,{className:"w-4 h-4"}),"Reintentar"]})})]})}function R({accountKey:t}){return e.jsx(p,{client:v,children:e.jsx(E,{accountKey:t})})}export{R as GamePage};
