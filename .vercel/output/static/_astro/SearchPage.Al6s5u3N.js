import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{r as l}from"./index.DiEladB3.js";import{Q as L,a as S,u as p,S as C,E as v,M as T,I as j,O as k}from"./ErrorBanner.CtW8yjaT.js";const I=new L({defaultOptions:{queries:{staleTime:3e4,retry:1,refetchOnWindowFocus:!1}}});function O({className:o="w-5 h-5"}){return e.jsxs("svg",{className:o,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("circle",{cx:"11",cy:"11",r:"8"}),e.jsx("path",{d:"M21 21l-4.35-4.35"})]})}const U=[{value:"LA2",label:"LAS",flag:"游깵"},{value:"LA1",label:"LAN",flag:"游깵"},{value:"NA1",label:"NA",flag:"游쥟릖"},{value:"BR1",label:"Brasil",flag:"游游"},{value:"EUW1",label:"EU West",flag:"游쀯릖"},{value:"EUN1",label:"EU Nordic & East",flag:"游쀯릖"},{value:"KR",label:"Korea",flag:"游썷릖"},{value:"JP1",label:"Jap칩n",flag:"游游"},{value:"OC1",label:"Ocean칤a",flag:"游뷣릖"},{value:"TR1",label:"Turqu칤a",flag:"游좷릖"},{value:"RU",label:"Rusia",flag:"游游"},{value:"PH2",label:"Filipinas",flag:"游왫릖"},{value:"SG2",label:"Singapur",flag:"游젏릖"},{value:"TH2",label:"Tailandia",flag:"游좷릖"},{value:"TW2",label:"Taiw치n",flag:"游좷릖"},{value:"VN2",label:"Vietnam",flag:"游游"},{value:"ME1",label:"Medio Oriente",flag:"游깴"}];function q(){const[o,y]=l.useState(""),[d,N]=l.useState("LA2"),[r,w]=l.useState(null),[E,m]=l.useState(0),[f,g]=l.useState(null),R=l.useCallback(()=>{g(null);const a=o.trim();if(!a)return;let t,u;if(a.includes("#")){const s=a.split("#");t=s[0].trim(),u=s.slice(1).join("#").trim()}else{const s=a.split(/\s+/);if(s.length<2){g("Formato: Nombre#Tag (ej: HideOnBush#KR1)");return}u=s.pop(),t=s.join(" ")}if(!t||!u){g("Formato: Nombre#Tag (ej: HideOnBush#KR1)");return}w({gameName:t,tagLine:u,platform:d}),m(0)},[o,d]),n=p({queryKey:["search-resolve",r?.gameName,r?.tagLine,r?.platform],queryFn:async()=>{const t=await(await fetch(`/api/search?gameName=${encodeURIComponent(r.gameName)}&tagLine=${encodeURIComponent(r.tagLine)}&platform=${encodeURIComponent(r.platform)}`)).json();if(!t.ok)throw new Error(t.error?.message??"No se encontr칩 la cuenta");return t.data},enabled:!!r}),i=p({queryKey:["search-live-game",n.data?.puuid,r?.platform,E],queryFn:async()=>{const a=n.data.puuid,t=r.platform,s=await(await fetch(`/api/live-game?puuid=${encodeURIComponent(a)}&platform=${encodeURIComponent(t)}`)).json();if(!s.ok)throw new Error(s.error?.message??"Error buscando partida");return s.data},enabled:!!n.data?.puuid}),h=p({queryKey:["ddragon-bootstrap"],queryFn:async()=>{const t=await(await fetch("/api/ddragon/bootstrap")).json();if(!t.ok)throw new Error(t.error?.message??"DDragon failed");return t.data},staleTime:3600*1e3}),x=r&&(n.isLoading||i.isLoading||h.isLoading),c=i.data,b=h.data;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"max-w-xl mx-auto",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-white mb-2",children:"Buscar invocador"}),e.jsx("p",{className:"text-gray-400 text-sm",children:"Ingres치 el nombre y tag del invocador para ver su partida en vivo"})]}),e.jsxs("form",{onSubmit:a=>{a.preventDefault(),R()},className:"flex gap-2",children:[e.jsx("select",{value:d,onChange:a=>N(a.target.value),className:"px-3 py-3 bg-gray-800 border border-gray-600 rounded-xl text-white text-sm focus:outline-none focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 transition-colors shrink-0 cursor-pointer",children:U.map(a=>e.jsxs("option",{value:a.value,children:[a.flag," ",a.label]},a.value))}),e.jsxs("div",{className:"relative flex-1",children:[e.jsx(O,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-500"}),e.jsx("input",{type:"text",value:o,onChange:a=>y(a.target.value),placeholder:"Nombre#Tag (ej: HideOnBush#KR1)",className:"w-full pl-10 pr-4 py-3 bg-gray-800 border border-gray-600 rounded-xl text-white placeholder-gray-500 focus:outline-none focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 transition-colors",autoFocus:!0})]}),e.jsx("button",{type:"submit",disabled:!o.trim(),className:"px-6 py-3 bg-indigo-600 hover:bg-indigo-500 disabled:bg-gray-700 disabled:text-gray-500 text-white font-semibold rounded-xl transition-colors shrink-0",children:"Buscar"})]}),f&&e.jsx("p",{className:"text-red-400 text-sm mt-2 text-center",children:f})]}),x&&e.jsx(C,{}),n.isError&&r&&e.jsx(v,{message:n.error.message}),i.isError&&!i.isLoading&&e.jsx(v,{message:i.error.message}),!x&&c?.available&&b&&e.jsxs("div",{children:[e.jsx(T,{game:c,ddragon:b,platform:r?.platform??"LA2"}),e.jsx("div",{className:"text-center mt-6",children:e.jsxs("button",{onClick:()=>m(a=>a+1),className:"inline-flex items-center gap-1.5 text-sm text-gray-400 hover:text-white transition-colors",children:[e.jsx(j,{className:"w-4 h-4"}),"Refrescar partida"]})})]}),!x&&n.data&&c&&!c.available&&e.jsxs("div",{children:[e.jsx(k,{account:n.data.account,reason:c.reason??"NOT_IN_GAME"}),e.jsx("div",{className:"text-center mt-4",children:e.jsxs("button",{onClick:()=>m(a=>a+1),className:"inline-flex items-center gap-1.5 text-sm text-gray-500 hover:text-gray-300 transition-colors",children:[e.jsx(j,{className:"w-4 h-4"}),"Reintentar"]})})]})]})}function K(){return e.jsx(S,{client:I,children:e.jsx(q,{})})}export{K as SearchPage};
